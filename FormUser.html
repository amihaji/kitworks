<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Login KitWorks</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { 
  background-color: #f8f9fa; 
}
.card { 
  max-width: 400px; 
  margin: 50px auto; 
}
</style>
</head>

<body>
<div class="card shadow">
  <div class="card-body">
    <h4 class="card-title text-center mb-4">Login KitWorks</h4>
    <div class="mb-3">
      <!--
      <label for="userId" class="form-label">User ID</label>
      <input type="text" id="userId" class="form-control" placeholder="Masukkan User ID">
      -->
      <label for="userId" class="form-label">User ID</label>
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-user"></i></span>
        <input type="text" class="form-control" id="userId" name="userId" required minlength="4" maxlength="6">
      </div>
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Password</label>
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-lock"></i></span>
        <input type="password" class="form-control" id="userPass" name="userPass" required minlength="6" maxlength="10">
      </div>
      <!--
      <label for="userPass" class="form-label">Password</label>
      <span class="input-group-text"><i class="fas fa-lock"></i></span>
      <input type="password" id="userPass" class="form-control" placeholder="Masukkan Password">
      -->
    </div>
    <div class="d-grid">
      <button id="btnLogin" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Login</button>
    </div>
  </div>
</div>

<script>
const URL_APPS_SCRIPT = 'https://script.google.com/macros/s/AKfycby46ltuXXMXzJm62nnxYuCdLHtFMUulKPFyenhk5RGE0owoP-XK8ljGt_r-AIogmNcbHA/exec';

document.getElementById('btnLogin').addEventListener('click', () => {
  const userId = document.getElementById('userId').value.trim();
  const userPass = document.getElementById('userPass').value.trim();

  if (!userId || !userPass) {
    alert('User ID dan Password harus diisi.');
    return;
  }

  const callbackName = 'cb_' + Date.now();
  const script = document.createElement('script');
  script.src = `${URL_APPS_SCRIPT}?action=checkLogin&userId=${encodeURIComponent(userId)}&userPass=${encodeURIComponent(userPass)}&callback=${callbackName}`;

  window[callbackName] = function(response) {
    if (response.status === 'success' && response.loggedIn) {
      // Simpan session login
      sessionStorage.setItem('userId', response.userId);
      sessionStorage.setItem('userToken', response.token);
      sessionStorage.setItem('userLevel', response.level);

      // Simpan hak akses
      if (response.access) {
        sessionStorage.setItem('aksesList', JSON.stringify(response.access));
      }

      window.location.href = 'index.html';
    } else {
      alert(response.message || 'User ID atau Password salah.');
    }
    document.body.removeChild(script);
    delete window[callbackName];
  };

  script.onerror = () => {
    alert('Gagal terhubung ke server.');
    document.body.removeChild(script);
    delete window[callbackName];
  };

  document.body.appendChild(script);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
