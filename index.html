<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KitWorks</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
body { background-color: #f8f9fa; }
.button-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 20px; }
.button-grid button { width: 200px; }
</style>
</head>
<body>
<div class="container text-center mt-5">
    <h2>KitWorks Main Menu</h2>
    <div class="button-grid mt-4">
        <button id="btnDashWE" class="btn btn-primary" disabled>DashWE</button>
        <button id="btnSetup" class="btn btn-success" disabled>Setup User</button>
        <button id="btnTools" class="btn btn-info" disabled>WE Tools</button>
        <button id="btnSurvey" class="btn btn-warning" disabled>Survey</button>
        <button id="btnLogin" class="btn btn-dark">Login</button>
        <button id="btnLogout" class="btn btn-danger" disabled>Logout</button>
    </div>
</div>

<script>
const URL_APPS_SCRIPT = 'https://script.google.com/macros/s/AKfycbxb1FPyfHrv7tPZ_6ro3R5zQUVTleIBLYSwFBfHVsyHhgH_FU-rLBpgJ3KszWxqtZrp_A/exec';

document.getElementById('btnLogin').addEventListener('click', () => {
    window.location.href = 'FormUser.html';
});

document.getElementById('btnLogout').addEventListener('click', () => {
    sessionStorage.clear();
    alert('Anda telah logout.');
    location.reload();
});

// Cek apakah user sudah login
const userId = sessionStorage.getItem('userId');
const userToken = sessionStorage.getItem('userToken');

if (userId && userToken) {
    document.getElementById('btnLogin').disabled = true;
    document.getElementById('btnLogout').disabled = false;

    const callbackName = 'cb_' + Date.now();
    const script = document.createElement('script');
    script.src = `${URL_APPS_SCRIPT}?action=getUserAccess&userId=${userId}&token=${userToken}&callback=${callbackName}`;

    window[callbackName] = function(response) {
        if (response.status === 'success') {
            if (response.access.dashwe === 'Y') document.getElementById('btnDashWE').disabled = false;
            if (response.access.setupuser === 'Y') document.getElementById('btnSetup').disabled = false;
            if (response.access.wetools === 'Y') document.getElementById('btnTools').disabled = false;
            if (response.access.survey === 'Y') document.getElementById('btnSurvey').disabled = false;
        } else {
            alert(response.message || 'Gagal mendapatkan hak akses.');
        }
        document.body.removeChild(script);
        delete window[callbackName];
    };

    document.body.appendChild(script);
}
</script>
</body>
</html>
